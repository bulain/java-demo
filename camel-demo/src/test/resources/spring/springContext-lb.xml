<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:camel="http://camel.apache.org/schema/spring" xsi:schemaLocation="
         http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
         http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">

    <bean id="service" class="com.bulain.camel.lb.Reporting" />
    <bean id="generator" class="com.bulain.camel.lb.Generator" />

    <camelContext xmlns="http://camel.apache.org/schema/spring">

        <route id="mina1">
            <from uri="mina:tcp://localhost:9991" />
            <setHeader headerName="minaServer">
                <constant>localhost:9991</constant>
            </setHeader>
            <bean ref="service" method="updateReport" />
        </route>
        <route id="mina2">
            <from uri="mina:tcp://localhost:9992" />
            <setHeader headerName="minaServer">
                <constant>localhost:9992</constant>
            </setHeader>
            <bean ref="service" method="updateReport" />
        </route>

        <route id="sendMessage">
            <from uri="timer://loadbalancer?period=10s" />
            <bean ref="generator" method="createReport" />
            <to uri="direct:loadbalance" />
        </route>

        <route id="loadbalancer">
            <from uri="direct:loadbalance" />
            <loadBalance inheritErrorHandler="false">
                <failover roundRobin="true" />
                <to uri="mina:tcp://localhost:9991?sync=true" />
                <to uri="mina:tcp://localhost:9992?sync=true" />
            </loadBalance>
            <log message="${body}" />
        </route>

    </camelContext>

</beans>
